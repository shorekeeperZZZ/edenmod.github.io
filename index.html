<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="Khám phá kho mod game lớn nhất dành cho cộng đồng game thủ Việt tại Eden Mod. Cung cấp thông tin, link tải và các chức năng mod chi tiết.">

    <link rel="icon" href="eden-og-image.png" type="image/png">
    <title>Eden Mod</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- Thêm các thư viện Firebase và Discord -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@widgetbot/discord-api@1.0.0/dist/discord.min.js"></script>
    <style>
        :root {
            --bg-primary: #020010;
            --glass-bg: rgba(10, 8, 38, 0.55);
            --glass-bg-hover: rgba(10, 8, 38, 0.75);
            --primary-accent: #a855f7;
            --secondary-accent: #2563eb;
            --text-primary: #f0f2f5;
            --text-secondary: #a0aec0;
            --border-color: rgba(168, 85, 247, 0.3);
            --shadow-color: rgba(0, 0, 0, 0.5);
            --status-ok: #4ade80;
            --status-updating: #38bdf8;
            --status-stopped: #f472b6;
            --star-color: #ffd700;
            --star-empty: #6b7280;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            scroll-behavior: smooth;
        }

        #user-info {
            background: var(--glass-bg);
            padding: 0.5rem 1rem;
            border-radius: 50px;
            border: 1px solid var(--border-color);
            backdrop-filter: blur(10px);
        }

        #username {
            font-weight: 600;
            color: var(--text-primary);
        }

        #user-info button:hover {
            color: var(--primary-accent);
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.7;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            overflow-x: hidden;
        }

        .loading-spinner {
            grid-column: 1 / -1;
            text-align: center;
            padding: 2rem;
            color: var(--text-secondary);
        }

        .loading-spinner .spinner {
            width: 40px;
            height: 40px;
            margin: 0 auto 1rem;
            border-radius: 50%;
            border: 3px solid var(--border-color);
            border-top-color: var(--primary-accent);
            animation: spin 1s linear infinite;
        }

        /* Rating stars */
        .star {
            color: var(--star-color);
            display: inline-block;
            margin: 0 2px;
        }

        .star.empty {
            color: var(--star-empty);
        }

        .star:hover {
            transform: scale(1.2);
            text-shadow: 0 0 8px var(--star-color);
        }

        /* Rating modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            animation: fadeIn 0.3s ease-out;
        }

        .modal-content {
            background-color: var(--glass-bg);
            margin: 15% auto;
            padding: 2rem;
            border-radius: 16px;
            max-width: 500px;
            border: 1px solid var(--border-color);
            backdrop-filter: blur(10px);
        }

        .modal-content h3 {
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .stars-container {
            text-align: center;
            margin: 1.5rem 0;
            font-size: 2rem;
        }

        .rating-status {
            text-align: center;
            color: var(--text-secondary);
            margin-top: 1rem;
        }

        .rating-status.success {
            color: var(--status-ok);
        }

        .rating-status.error {
            color: var(--status-stopped);
        }

        .close-modal {
            float: right;
            font-size: 1.5rem;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close-modal:hover {
            color: var(--primary-accent);
        }

        /* Thêm vào phần style */
        #ratingComment::placeholder {
            color: var(--text-secondary);
            opacity: 0.7;
        }

        #comments-list {
            max-height: 300px;
            overflow-y: auto;
            padding-right: 10px;
        }

        #comments-list::-webkit-scrollbar {
            width: 5px;
        }

        #comments-list::-webkit-scrollbar-thumb {
            background-color: var(--primary-accent);
            border-radius: 10px;
        }

        .rating-button {
            background: var(--glass-bg);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 8px 16px;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            margin-left: 0.5rem;
        }

        .rating-button:hover {
            background: var(--primary-accent);
            border-color: var(--primary-accent);
        }

        .discord-login-button {
            background: linear-gradient(135deg, #5865F2, #7289DA);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 50px;
            font-size: 1rem;
            cursor: pointer;
            transition: transform 0.3s ease;
            margin-top: 1rem;
        }

        .discord-login-button:hover {
            transform: translateY(-2px);
        }

        .rating-info {
            margin: 0.5rem 0;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
        }

        .rating-text {
            margin-left: 0.5rem;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* Phần còn lại của CSS giữ nguyên */
        #galaxy-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }

        /* Hiệu ứng và Preloader */
        #preloader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1000;
            background-color: var(--bg-primary);
            display: grid;
            place-items: center;
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }

        #preloader.loaded {
            opacity: 0;
            visibility: hidden;
        }

        .spinner {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 5px solid var(--border-color);
            border-top-color: var(--primary-accent);
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes text-glow {
            from {
                text-shadow: 0 0 10px rgba(168, 85, 247, 0.8);
            }

            to {
                text-shadow: 0 0 20px rgba(168, 85, 247, 1), 0 0 30px rgba(37, 99, 235, 0.8);
            }
        }

        /* Phần Header */
        .header {
            padding: 4rem 1.5rem;
            text-align: center;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
        }

        .header-logo {
            width: 140px;
            height: 140px;
            border-radius: 50%;
            margin-bottom: 1.5rem;
            object-fit: cover;
            border: 3px solid var(--primary-accent);
            box-shadow: 0 0 25px var(--primary-accent), 0 0 40px var(--secondary-accent) inset;
        }

        .header h1 {
            font-size: clamp(2.5rem, 6vw, 4rem);
            font-weight: 700;
            color: #fff;
            text-transform: uppercase;
            letter-spacing: 5px;
            animation: text-glow 2s ease-in-out infinite alternate;
        }

        .header p {
            font-size: clamp(1rem, 2.5vw, 1.25rem);
            color: var(--text-secondary);
            margin-top: 1rem;
            max-width: 650px;
        }

        .discord-button {
            display: inline-block;
            margin-top: 2.5rem;
            padding: 16px 40px;
            background: linear-gradient(135deg, var(--primary-accent), var(--secondary-accent));
            color: #fff;
            text-decoration: none;
            font-weight: 600;
            border-radius: 50px;
            font-size: 1.15rem;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            box-shadow: 0 0 20px rgba(168, 85, 247, 0.5);
            border: none;
        }

        .discord-button:hover,
        .discord-button:focus {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 0 35px rgba(168, 85, 247, 0.8);
        }

        /* Bố cục chính */
        .container {
            padding: 3rem 1.5rem;
            max-width: 1600px;
            margin: auto;
            position: relative;
            z-index: 2;
        }

        /* Chế độ xem danh sách */
        #main-view {
            animation: fadeIn 0.5s ease-in-out;
        }

        /* Khu vực điều khiển */
        .controls-container {
            background-color: var(--glass-bg);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 3rem;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }

        .filter-container {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .filter-btn {
            background-color: transparent;
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
            padding: 10px 22px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95rem;
            transition: all 0.3s ease;
        }

        /* Thêm vào phần style */
        .comment-rating {
            color: var(--star-color);
            font-size: 0.9rem;
            margin-left: 0.5rem;
        }

        .comment-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
            flex-wrap: wrap;
        }

        .comment-user {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .comment-date {
            color: var(--text-secondary);
            font-size: 0.8rem;
            margin-left: auto;
        }

        .filter-btn:hover {
            color: var(--text-primary);
            border-color: var(--primary-accent);
            box-shadow: 0 0 10px var(--primary-accent);
        }

        .filter-btn.active {
            background: var(--primary-accent);
            color: #fff;
            border-color: var(--primary-accent);
            box-shadow: 0 0 15px var(--primary-accent);
        }

        .search-container {
            position: relative;
            max-width: 700px;
            margin: 0 auto;
        }

        #searchInput {
            width: 100%;
            padding: 16px 20px 16px 55px;
            font-size: 1.1rem;
            border-radius: 50px;
            border: 1px solid var(--border-color);
            background-color: rgba(0, 0, 0, 0.2);
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        #searchInput::placeholder {
            color: var(--text-secondary);
        }

        #searchInput:focus {
            outline: none;
            border-color: var(--primary-accent);
            box-shadow: 0 0 0 4px rgba(168, 85, 247, 0.3);
        }

        .search-container::before {
            content: '🔍';
            position: absolute;
            left: 22px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.4rem;
            opacity: 0.6;
        }

        .game-counter {
            text-align: center;
            color: var(--text-secondary);
            margin-bottom: 2rem;
            font-size: 1.1rem;
        }

        /* Lưới hiển thị Game */
        #gameList {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 2rem;
        }

        /* Thẻ game */
        .game-card {
            background-color: var(--glass-bg);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 1.75rem;
            border: 1px solid var(--border-color);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
            transition: transform 0.4s ease, box-shadow 0.4s ease, border-color 0.4s ease;
            display: flex;
            flex-direction: column;
            animation: fadeIn 0.5s ease-out forwards;
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        .game-card:hover {
            transform: translateY(-10px) perspective(1000px) rotateX(2deg);
            box-shadow: 0 0 25px var(--status-color), 0 0 40px rgba(0, 0, 0, 0.6);
            border-color: var(--status-color);
        }

        .game-card h3 {
            color: var(--text-primary);
            margin-top: 0;
            margin-bottom: 1rem;
            font-size: 1.5rem;
            font-weight: 600;
        }

        .info-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
            color: var(--text-secondary);
        }

        .info-item .icon-wrapper {
            width: 24px;
            height: 24px;
            display: grid;
            place-items: center;
            color: var(--primary-accent);
        }

        #submitRatingBtn {
            transition: all 0.3s ease;
            margin-top: 1rem;
        }

        #submitRatingBtn:hover {
            background: var(--secondary-accent) !important;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        #ratingError {
            transition: all 0.3s ease;
        }

        .info-item .icon-wrapper svg {
            width: 20px;
            height: 20px;
        }

        .info-item .status {
            font-weight: 600;
            color: var(--status-color);
            text-shadow: 0 0 5px var(--status-color);
        }

        .features-wrapper {
            margin-top: auto;
            padding-top: 1.25rem;
            border-top: 1px solid var(--border-color);
        }

        .features-wrapper strong {
            color: var(--text-primary);
            display: block;
            margin-bottom: 0.75rem;
        }

        .features-list {
            list-style-type: none;
            padding-left: 0;
            display: flex;
            flex-wrap: wrap;
            gap: 0.6rem;
        }

        .feature-tag {
            background-color: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--text-secondary);
            padding: 5px 12px;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 400;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .feature-tag .feature-icon {
            width: 16px;
            height: 16px;
            stroke-width: 2;
        }

        .feature-tag:hover {
            background-color: var(--primary-accent);
            color: #fff;
            border-color: var(--primary-accent);
        }

        .no-results {
            grid-column: 1 / -1;
            text-align: center;
            padding: 4rem;
            color: var(--text-secondary);
            font-size: 1.3rem;
            background-color: var(--glass-bg);
            border-radius: 16px;
        }

        /* --- Chế độ xem chi tiết --- */
        #detail-view {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }

        .back-button {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: var(--glass-bg);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 10px 20px;
            border-radius: 50px;
            cursor: pointer;
            margin-bottom: 2rem;
            transition: all 0.3s ease;
        }

        .back-button:hover {
            background: var(--primary-accent);
            border-color: var(--primary-accent);
            box-shadow: 0 0 15px var(--primary-accent);
        }

        .detail-content {
            background-color: var(--glass-bg);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: clamp(1.5rem, 5vw, 3rem);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }

        .detail-header {
            margin-bottom: 2rem;
        }

        #detail-title {
            font-size: clamp(2rem, 5vw, 3rem);
            font-weight: 700;
            color: #fff;
            text-shadow: 0 0 15px var(--primary-accent);
            margin: 0;
        }

        #detail-title a {
            color: inherit;
            text-decoration: none;
            transition: color 0.3s ease, text-shadow 0.3s ease;
        }

        #detail-title a:hover {
            color: var(--status-updating);
            text-shadow: 0 0 15px var(--status-updating);
        }

        .video-wrapper {
            max-width: 70%;
            margin: 0 auto 2rem auto;
        }

        #video-container {
            position: relative;
            padding-bottom: 56.25%;
            height: 0;
            overflow: hidden;
            max-width: 100%;
            background: #000;
            border-radius: 12px;
            border: 1px solid var(--border-color);
        }

        #video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        #detail-description,
        #detail-features {
            margin-bottom: 2.5rem;
        }

        #detail-description p {
            color: var(--text-secondary);
        }

        #detail-features .features-list {
            gap: 0.8rem;
        }

        #detail-features .feature-tag {
            font-size: 1rem;
            padding: 8px 16px;
        }

        .detail-actions {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        #detail-discord-link {
            flex-grow: 1;
            display: inline-block;
            text-align: center;
            padding: 18px 30px;
            background: linear-gradient(135deg, #23d5ab, #38bdf8);
            color: #fff;
            text-decoration: none;
            font-weight: 700;
            border-radius: 12px;
            font-size: 1.25rem;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            box-shadow: 0 0 20px rgba(35, 213, 171, 0.5);
            border: none;
        }

        #detail-discord-link:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 0 35px rgba(35, 213, 171, 0.8);
        }

        #copy-discord-link {
            padding: 18px 20px;
            background: var(--glass-bg);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.1rem;
        }

        #copy-discord-link:hover {
            border-color: var(--primary-accent);
            color: var(--primary-accent);
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 3rem;
            margin-top: 3rem;
            border-top: 1px solid var(--border-color);
            font-size: 1rem;
            color: var(--text-secondary);
            position: relative;
        }

        @media (max-width: 700px) {
            .container {
                padding: 1rem 0.5rem;
            }

            .header {
                padding: 2rem 0.5rem;
            }

            .header-logo {
                width: 90px;
                height: 90px;
                margin-bottom: 1rem;
            }

            .header h1 {
                font-size: 2rem;
            }

            .controls-container {
                padding: 1rem;
            }

            #gameList {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .game-card {
                padding: 1rem;
                font-size: 0.98rem;
            }

            .features-wrapper {
                padding-top: 0.7rem;
            }

            .features-list {
                gap: 0.3rem;
            }

            .feature-tag {
                font-size: 0.85rem;
                padding: 4px 8px;
            }

            .info-item {
                gap: 0.5rem;
                margin-bottom: 0.5rem;
                font-size: 0.98rem;
            }

            .info-item .icon-wrapper {
                width: 20px;
                height: 20px;
            }

            .info-item .icon-wrapper svg {
                width: 16px;
                height: 16px;
            }

            .no-results {
                padding: 2rem 0.5rem;
                font-size: 1rem;
            }

            .detail-content {
                padding: 1rem 0.5rem;
            }

            .video-wrapper {
                max-width: 100%;
            }

            #detail-title {
                font-size: 1.3rem;
            }

            .back-button {
                padding: 8px 12px;
                font-size: 0.98rem;
            }

            #detail-discord-link,
            #copy-discord-link {
                padding: 12px 10px;
                font-size: 1rem;
            }

            .footer {
                padding: 1.5rem 0.5rem;
                font-size: 0.95rem;
            }

            /* Responsive modal */
            .modal-content {
                width: 90%;
                margin: 20% auto;
                padding: 1rem;
            }

            .stars-container {
                font-size: 1.5rem;
            }
        }
    </style>
</head>

<body>
    <div id="preloader">
        <div class="spinner"></div>
    </div>

    <canvas id="galaxy-bg"></canvas>

    <!-- Rating Modal -->
    <div id="ratingModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeRatingModal()">&times;</span>
            <h3 id="ratingGameTitle"></h3>
            <div class="stars-container">
                <span class="star" onclick="updateRating(1)">★</span>
                <span class="star" onclick="updateRating(2)">★</span>
                <span class="star" onclick="updateRating(3)">★</span>
                <span class="star" onclick="updateRating(4)">★</span>
                <span class="star" onclick="updateRating(5)">★</span>
            </div>
            <p id="ratingError"
                style="color: var(--status-stopped); text-align: center; margin: 0.5rem 0; display: none;">Vui lòng chọn
                số sao và nhập nhận xét!</p>
            <div style="margin: 1rem 0;">
                <textarea id="ratingComment" placeholder="Nhận xét của bạn về game này (bắt buộc)..." style="width: 100%; padding: 10px; border-radius: 8px; 
                 background: rgba(0,0,0,0.2); border: 1px solid var(--border-color);
                 color: var(--text-primary); min-height: 80px;"></textarea>
            </div>
            <button id="submitRatingBtn" onclick="submitRating()"
                style="width: 100%; padding: 12px; background: var(--primary-accent); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;">Gửi
                đánh giá</button>
            <p id="ratingStatus" class="rating-status"></p>
        </div>
    </div>

    <!-- Discord Login Modal -->
    <div id="discordLoginModal" class="modal">
        <div class="modal-content">
            <h3>Đăng nhập bằng Discord</h3>
            <p style="margin-bottom: 1.5rem; color: var(--text-secondary);">Bạn cần đăng nhập để đánh giá "<span
                    id="gameToRateName"></span>"</p>
            <button class="discord-login-button" onclick="loginWithDiscord()">
                Đăng nhập với Discord
            </button>
            <p style="margin-top: 1rem; color: var(--text-secondary); font-size: 0.9rem;">
                Sau khi đăng nhập, bạn sẽ được chuyển hướng trở lại để đánh giá game.
            </p>
        </div>
    </div>

    <header class="header">
        <img src="edenimage.png" alt="Eden Mod Logo" class="header-logo" onerror="this.style.display='none'">
        <div id="user-info" style="display: none; margin-bottom: 1rem;">
            <div style="display: flex; align-items: center; gap: 0.5rem;">
                <img id="user-avatar" width="40" height="40"
                    style="border-radius: 50%; border: 2px solid var(--primary-accent);">
                <span id="username"></span>
                <button onclick="logout()"
                    style="background: transparent; border: none; color: var(--text-secondary); cursor: pointer; margin-left: 0.5rem;">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                        <polyline points="16 17 21 12 16 7"></polyline>
                        <line x1="21" y1="12" x2="9" y2="12"></line>
                    </svg>
                </button>
            </div>
        </div>
        <h1>Eden Mod</h1>
        <p>
            <b>Không Root:</b> Mod game an toàn, không can thiệp hệ thống.<br>
            <b>Không Phí:</b> Mod chất lượng, hoàn toàn miễn phí - vì đam mê.<br>
            <b>Không "Làm màu":</b> Uy tín là hàng đầu, chất lượng là giá trị cốt lõi.<br>
        </p>
        <a href="https://discord.gg/edenmod" target="_blank" rel="noopener noreferrer" class="discord-button">
            Gia nhập Thiên hà
        </a>
    </header>

    <div class="container">
        <main id="main-view">
            <section class="controls-container">
                <div id="filterContainer" class="filter-container">
                    <button class="filter-btn active" onclick="filterByStatus(event, 'all')">Tất cả</button>
                    <button class="filter-btn" onclick="filterByStatus(event, 'ok')">Hoạt động</button>
                    <button class="filter-btn" onclick="filterByStatus(event, 'updating')">Cập Nhật</button>
                    <button class="filter-btn" onclick="filterByStatus(event, 'stopped')">Đã Dừng</button>
                </div>
                <div class="search-container">
                    <input type="text" id="searchInput" onkeyup="renderGameList()"
                        placeholder="Dịch chuyển đến game...">
                </div>
            </section>

            <div id="gameCounter" class="game-counter"></div>
            <section id="gameList">
            </section>
        </main>

        <section id="detail-view">
            <button class="back-button" onclick="showMainView()">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="19" y1="12" x2="5" y2="12"></line>
                    <polyline points="12 19 5 12 12 5"></polyline>
                </svg>
                Quay lại vũ trụ
            </button>
            <div class="detail-content">
                <div class="detail-header">
                    <h2 id="detail-title"></h2>
                </div>
                <div class="video-wrapper">
                    <div id="video-container"></div>
                </div>
                <div id="detail-description">
                    <h3>Giới thiệu</h3>
                    <p></p>
                </div>
                <div id="detail-features">
                    <h3>Tín hiệu Mod chi tiết</h3>
                    <ul class="features-list"></ul>
                </div>
                <div class="detail-actions">
                    <a id="detail-discord-link" href="#" target="_blank" rel="noopener noreferrer">Vào Server
                        Discord</a>
                    <button id="copy-discord-link" onclick="copyDiscordLink(this)">Sao chép Link</button>
                </div>
            </div>
        </section>
    </div>

    <footer class="footer">
        <p>© 2025 Eden Mod. Mọi quyền được bảo lưu trong vũ trụ này.</p>
    </footer>

    <script>
        // --- Preloader Logic ---
        window.addEventListener('load', () => {
            setTimeout(() => {
                document.getElementById('preloader').classList.add('loaded');
            }, 500);
        });

        // --- Firebase Configuration ---
        const firebaseConfig = {
            apiKey: "AIzaSyCmufkGnshsyHRcbFZ8-ZVVKZjIUXFthAI",
            authDomain: "edenkey-752db.firebaseapp.com",
            databaseURL: "https://edenkey-752db-default-rtdb.firebaseio.com",
            projectId: "edenkey-752db",
            storageBucket: "edenkey-752db.firebasestorage.app",
            messagingSenderId: "1007298985052",
            appId: "1:1007298985052:web:ad386635d04e96a0ed3a99",
            measurementId: "G-GCMMXZTCM8"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);

        const database = firebase.database();

        // Discord OAuth configuration
        const DISCORD_CLIENT_ID = "1388338328956305428";
        const DISCORD_REDIRECT_URI = "https://shorekeeperzzz.github.io/edenmod.github.io/";
        const DISCORD_SCOPES = "identify email";

        // Global variables
        let currentUser = null;
        let currentGameToRate = null;
        let currentRating = 0;
        let isAutofilling = false;


        // --- Main App Logic ---
        document.addEventListener('DOMContentLoaded', () => {
            // --- Elements ---
            const mainView = document.getElementById('main-view');
            const detailView = document.getElementById('detail-view');
            const gameListContainer = document.getElementById('gameList');
            const searchInput = document.getElementById('searchInput');
            const gameCounter = document.getElementById('gameCounter');

            const rawGameData = [
                {
                    "name": "Kho Báu Đại Chiến",
                    "status": "Hoạt động",
                    "note": "Damage Multiplier, Defense Multiplier",
                    "description": "Tham gia vào cuộc phiêu lưu trên biển cả, tìm kiếm kho báu huyền thoại. Bản mod giúp bạn tăng cường sức mạnh để vượt qua mọi thử thách.",
                    "link": "https://khobaudaichien.vn/",
                    "videoId": "oB3DsSS7HX8",
                    "discordLink": "https://discord.gg/edenmod"
                },
                {
                    "name": "Thế Giới Hải Tặc",
                    "status": "Hoạt động",
                    "note": "Damage Multiplier, Defense Multiplier, No Skill Cooldown",
                    "description": "Trở thành vua hải tặc trong một thế giới rộng lớn. Sử dụng các chức năng mod để không có kỹ năng nào có thể cản bước bạn.",
                    "link": "https://thegioihaitac.vn/home",
                    "videoId": "L3VcW7Z994I",
                    "discordLink": "https://discord.gg/edenmod"
                },
                {
                    "name": "Đại Chiến Lục Đạo",
                    "status": "Hoạt động",
                    "note": "Damage Multiplier, Defense Multiplier, No Skill Cooldown",
                    "description": "Cuộc chiến của các nhẫn giả vĩ đại. Bản mod cung cấp sức mạnh vô song để bạn thống trị thế giới ninja.",
                    "link": "https://daichienlucdao.vn/",
                    "videoId": "L3VcW7Z994I",
                    "discordLink": "https://discord.gg/edenmod"
                },
                {
                    "name": "Mini Heroes: Magic Throne",
                    "status": "Hoạt động",
                    "note": "Damage Multiplier, Defense Multiplier, No Skill Cooldown",
                    "description": "Một thế giới ma thuật với những anh hùng tí hon nhưng sức mạnh vô hạn.",
                    "link": "https://play.google.com/store/apps/details?id=com.and.brawl.en",
                    "videoId": "rGex5U3xP1s",
                    "discordLink": "https://discord.gg/edenmod"
                },
                {
                    "name": "3Q: Thành Chủ Tiêu Dao",
                    "status": "Hoạt động",
                    "note": "Damage Multiplier, Defense Multiplier, No Skill Cooldown, Speed Multiplier",
                    "description": "Xây dựng và bảo vệ thành trì của bạn trong thời đại Tam Quốc hỗn loạn.",
                    "link": "https://play.google.com/store/apps/details?id=com.zjws.sea.vn",
                    "videoId": "9WV3B_RtTKU",
                    "discordLink": "https://discord.gg/edenmod"
                },
                {
                    "name": "Loạn Đấu Tây Du",
                    "status": "Hoạt động",
                    "note": "Damage Multiplier, Defense Multiplier, Always Win",
                    "description": "Một cuộc chiến hỗn loạn giữa các nhân vật Tây Du Ký. Với mod, chiến thắng luôn trong tầm tay.",
                    "link": "https://play.google.com/store/apps/details?id=com.vngw.gp",
                    "videoId": "UhNC-eXti_M",
                    "discordLink": "https://discord.gg/edenmod"
                },
                {
                    "name": "Võ Đài Nhẫn Giả",
                    "status": "Hoạt động",
                    "note": "Damage Multiplier, Defense Multiplier",
                    "description": "So tài trên võ đài để tìm ra nhẫn giả mạnh nhất.",
                    "link": "https://vodainhangia.com/",
                    "videoId": "oB3DsSS7HX8",
                    "discordLink": "https://discord.gg/edenmod"
                },
                {
                    "name": "Nhẫn Giới Truyền Thuyết",
                    "status": "Hoạt động",
                    "note": "Damage Multiplier, Defense Multiplier",
                    "description": "Viết nên huyền thoại của riêng bạn trong thế giới ninja.",
                    "link": "http://nhangioitruyenthuyet.top/",
                    "videoId": "oB3DsSS7HX8",
                    "discordLink": "https://discord.gg/edenmod"
                },
                {
                    "name": "Anh Trai Tam Quốc",
                    "status": "Hoạt động",
                    "note": "Damage Multiplier, Defense Multiplier",
                    "description": "Các anh hùng Tam Quốc trong một diện mạo hoàn toàn mới.",
                    "link": "https://www.facebook.com/anhtraitamquoc/",
                    "videoId": "NF6nNIqX2QU",
                    "discordLink": "https://discord.gg/edenmod"
                },
                {
                    "name": "Dragon Ball: Saiyans United",
                    "status": "Hoạt động",
                    "note": "Damage Multiplier, Defense Multiplier, No Skill Cooldown",
                    "description": "Hợp nhất sức mạnh Saiyan để bảo vệ vũ trụ.",
                    "link": "https://www.db-saiyans-united.com/vi",
                    "videoId": "Ce31ZxStEng",
                    "discordLink": "https://discord.gg/edenmod"
                },
                {
                    "name": "Home Defender – Wang’s Story",
                    "status": "Hoạt động",
                    "note": "Unlimited Resources, Speed",
                    "description": "Bảo vệ ngôi nhà của bạn khỏi những kẻ xâm lược với tài nguyên vô hạn.",
                    "link": "https://play.google.com/store/apps/details?id=com.warrior.wxw.gp",
                    "videoId": "Ce31ZxStEng",
                    "discordLink": "https://discord.gg/edenmod"
                },
                {
                    "name": "Nighty Knight: Frontier War TD",
                    "status": "Hoạt động",
                    "note": "Unlimited Resources, Auto Kill Enemies, Auto Win Wave, Speed",
                    "description": "Trở thành hiệp sĩ bóng đêm, bảo vệ biên giới khỏi lũ quái vật.",
                    "link": "https://play.google.com/store/apps/details?id=com.ezg011.duskbound.tower.defend.strategy.td.game",
                    "videoId": "NF6nNIqX2QU",
                    "discordLink": "https://discord.gg/edenmod"
                },
                {
                    "name": "Nightfall: Kingdom Frontier TD",
                    "status": "Hoạt động",
                    "note": "Unlimited Resources, Auto Kill Enemies, Auto Win Wave, Speed",
                    "description": "Xây dựng vương quốc và phòng thủ trước hoàng hôn.",
                    "link": "https://play.google.com/store/apps/details?id=com.fansipan.nightfall.tower.simulation.strategy.td.game",
                    "videoId": "NF6nNIqX2QU",
                    "discordLink": "https://discord.gg/edenmod"
                },
                {
                    "name": "Học Viện Siêu Hùng",
                    "status": "Hoạt động",
                    "note": "Damage Multiplier, Defense Multiplier",
                    "description": "Đào tạo những siêu anh hùng thế hệ mới tại học viện danh giá.",
                    "link": "https://hocviensieuhung.com/",
                    "videoId": "WSl7vjhCaNk",
                    "discordLink": "https://discord.gg/edenmod"
                },
                {
                    "name": "Đại Chiến Poke",
                    "status": "Hoạt động",
                    "note": "Damage Multiplier, Defense Multiplier",
                    "description": "Trở thành nhà huấn luyện tài ba trong các trận chiến poke đỉnh cao.",
                    "link": "https://daichienpoke.com/",
                    "videoId": "WSl7vjhCaNk",
                    "discordLink": "https://discord.gg/edenmod"
                },
                {
                    "name": "Ninja World War II",
                    "status": "Hoạt động",
                    "note": "Damage Multiplier, Defense Multiplier, No Skill Cooldown",
                    "description": "Tham gia Đại chiến Nhẫn giả lần thứ hai với sức mạnh vượt trội.",
                    "link": "https://play.google.com/store/apps/details?id=com.nww.gp.apk",
                    "videoId": "L3VcW7Z994I",
                    "discordLink": "https://discord.gg/edenmod"
                },
                {
                    "name": "UnderDark Defense",
                    "status": "Hoạt động",
                    "note": "Hero Unlock, Tower Unlock, Skin Unlock, Gold, Exp, Diamond Multiplier",
                    "description": "Phòng thủ những hầm ngục tăm tối với mọi thứ đã được mở khóa.",
                    "link": "https://play.google.com/store/apps/details?id=com.FreeDust.UnderDark",
                    "videoId": "Dc4OVL91jRE",
                    "discordLink": "https://discord.gg/edenmod"
                },
                {
                    "name": "Heroes & Dragons",
                    "status": "Hoạt động",
                    "note": "Free Shop, Speed",
                    "description": "Anh hùng và rồng, một sự kết hợp hoàn hảo để thống trị.",
                    "link": "https://play.google.com/store/apps/details?id=studio.banditos.banditos6",
                    "videoId": "NF6nNIqX2QU",
                    "discordLink": "https://discord.gg/edenmod"
                },
                {
                    "name": "Boom Castle: Tower Defense TD",
                    "status": "Hoạt động",
                    "note": "Free Shop, Speed",
                    "description": "Lâu đài của bạn sẽ bất khả xâm phạm với cửa hàng miễn phí.",
                    "link": "https://play.google.com/store/apps/details?id=castle.heroes.tower.defense.kingdom.magic.battle.archer",
                    "videoId": "NF6nNIqX2QU",
                    "discordLink": "https://discord.gg/edenmod"
                },
                {
                    "name": "Omega Royale",
                    "status": "Hoạt động",
                    "note": "Unlimited Silver & Mana, No Skill Cooldown, VIP, Speed",
                    "description": "Trận chiến hoàng gia cuối cùng với các đặc quyền VIP.",
                    "link": "https://play.google.com/store/apps/details?id=com.towerpop.omegaroyale",
                    "videoId": "NF6nNIqX2QU",
                    "discordLink": "https://discord.gg/edenmod"
                },
                {
                    "name": "Hero Blitz: RPG Roguelike",
                    "status": "Đã dừng",
                    "note": "Damage Multiplier, Defense multiplier, Free Shop, Speed",
                    "description": "Cuộc phiêu lưu roguelike tốc độ cao. (Dự án đã dừng)",
                    "link": "https://play.google.com/store/apps/details?id=com.ondi.swordroguelite",
                    "videoId": "NF6nNIqX2QU",
                    "discordLink": "https://discord.gg/edenmod"
                },
                {
                    "name": "Boomerang RPG:Watch out, Dude!",
                    "status": "Hoạt động",
                    "note": "Free Bonus, Resource Never Decrease, Speed",
                    "description": "Sử dụng boomerang và nhận các phần thưởng miễn phí.",
                    "link": "https://play.google.com/store/apps/details?id=com.superplanet.boomerang",
                    "videoId": "NF6nNIqX2QU",
                    "discordLink": "https://discord.gg/edenmod"
                },
                {
                    "name": "Manga Loạn Chiến",
                    "status": "Hoạt động",
                    "note": "Damage Multiplier, Defense Multiplier",
                    "description": "Các nhân vật manga yêu thích của bạn trong một trận chiến hỗn loạn.",
                    "link": "https://play.google.com/store/apps/details?id=com.game.mglc",
                    "videoId": "WSl7vjhCaNk",
                    "discordLink": "https://discord.gg/edenmod"
                },
                {
                    "name": "Bá Vương Đại Chiến",
                    "status": "Hoạt động",
                    "note": "Damage Multiplier, Defense Multiplier",
                    "description": "Tranh đoạt ngôi vị bá vương với sức mạnh vượt trội.",
                    "link": "https://bavuongdaichien.mobi/",
                    "videoId": "WSl7vjhCaNk",
                    "discordLink": "https://discord.gg/edenmod"
                },
                {
                    "name": "Fortias Saga: Idle RPG",
                    "status": "Hoạt động",
                    "note": "Remove Ads, Unlock All Hero, Unlock All Skin, Custom Resources, Speed",
                    "description": "Một câu chuyện sử thi nhàn rỗi không có quảng cáo và mọi thứ đã được mở khóa.",
                    "link": "https://play.google.com/store/apps/details?id=com.ondi.fortias.saga",
                    "videoId": "NF6nNIqX2QU",
                    "discordLink": "https://discord.gg/edenmod"
                },
                {
                    "name": "Ngự Kiếm Sinh Tồn",
                    "status": "Hoạt động",
                    "note": "No Skill CD, God Mode, Auto Collect",
                    "description": "Sinh tồn trong thế giới kiếm hiệp với các kỹ năng bất tử.",
                    "link": "https://play.google.com/store/apps/details?id=com.colocess.opengame.ngukiem",
                    "videoId": "UxePDXivvIY",
                    "discordLink": "https://discord.gg/edenmod"
                },
                {
                    "name": "Nuôi Thỏ Ngọc",
                    "status": "Hoạt động",
                    "note": "No Skill CD, OHK, God Mode, Dumb Enemies, Speed",
                    "description": "Nuôi thỏ ngọc của bạn trở thành một cỗ máy hủy diệt.",
                    "link": "https://apkcombo.com/vi/idlemoonrabbit-x-eternalreturn/com.AbleGames.DalToKi/",
                    "videoId": "ujMLCOQbAGA",
                    "discordLink": "https://discord.gg/edenmod"
                },
                {
                    "name": "Ethereal Hunter IDLE RPG",
                    "status": "Hoạt động",
                    "note": "Free Shop, Auto Clear, Speed",
                    "description": "Săn lùng các thực thể ethereal với cửa hàng miễn phí.",
                    "link": "https://play.google.com/store/apps/details?id=com.firstgames.girlhunter_global",
                    "videoId": "berSTxHHgI8",
                    "discordLink": "https://discord.gg/edenmod"
                },
                {
                    "name": "Wittle Defender",
                    "status": "Hoạt động",
                    "note": "God Mode, Speed",
                    "description": "Trở thành người bảo vệ tí hon bất khả chiến bại.",
                    "link": "https://play.google.com/store/apps/details?id=com.game.kingrush",
                    "videoId": "xm-0Z_Yk2oU",
                    "discordLink": "https://discord.gg/edenmod"
                },
                {
                    "name": "Dino Hero Go",
                    "status": "Hoạt động",
                    "note": "Attack Speed & Range, Speed",
                    "description": "Anh hùng khủng long với tốc độ và tầm đánh không giới hạn.",
                    "link": "https://play.google.com/store/apps/details?id=com.droidhang.dn.android.google",
                    "videoId": "YYdT2sv6y5s",
                    "discordLink": "https://discord.gg/edenmod"
                },
                {
                    "name": "Lucky Offense-Spin Squad!",
                    "status": "Hoạt động",
                    "note": "HP Multiplier, Attack Multiplier, Speed",
                    "description": "Cuộc tấn công may mắn với sức mạnh được nhân lên nhiều lần.",
                    "link": "https://play.google.com/store/apps/details?id=com.percent.aos.luckyrolling",
                    "videoId": "4fpXxediZOw",
                    "discordLink": "https://discord.gg/edenmod"
                },
                {
                    "name": "IMAE Guardian Girl",
                    "status": "Hoạt động",
                    "note": "Free Shop, Speed",
                    "description": "Cô gái hộ vệ với cửa hàng miễn phí.",
                    "link": "https://play.google.com/store/apps/details?id=com.wondersquad.imaegirl",
                    "videoId": "LUUHZ52goz4",
                    "discordLink": "https://discord.gg/edenmod"
                },
                {
                    "name": "Idle Weapon Shop",
                    "status": "Hoạt động",
                    "note": "Free Shop, Speed",
                    "description": "Quản lý cửa hàng vũ khí nhàn rỗi của bạn.",
                    "link": "https://play.google.com/store/apps/details?id=com.wondersquad.imaegirl",
                    "videoId": "NF6nNIqX2QU",
                    "discordLink": "https://discord.gg/edenmod"
                },
                {
                    "name": "Wulin Buzz",
                    "status": "Hoạt động",
                    "note": "Auto Win, Speed",
                    "description": "Khuấy đảo võ lâm với tính năng tự động thắng.",
                    "link": "https://play.google.com/store/apps/details?id=com.pandagame.twzm.and",
                    "videoId": "nhHcPJ-7oBk",
                    "discordLink": "https://discord.gg/edenmod"
                },
                {
                    "name": "Legendary Girl Warrior Idle",
                    "status": "Hoạt động",
                    "note": "Free Costume Shop, Auto Clear, Speed",
                    "description": "Nữ chiến binh huyền thoại với cửa hàng trang phục miễn phí.",
                    "link": "https://play.google.com/store/apps/details?id=com.firstgames.girlhunter",
                    "videoId": "berSTxHHgI8",
                    "discordLink": "https://discord.gg/edenmod"
                },
                {
                    "name": "Grandzenka: Idle RPG",
                    "status": "Hoạt động",
                    "note": "Free Shop, Speed",
                    "description": "Chiến binh Trái Đất trong một game RPG nhàn rỗi.",
                    "link": "https://play.google.com/store/apps/details?id=studio.gameberry.earthwarrior",
                    "videoId": "4flXowqZsuA",
                    "discordLink": "https://discord.gg/edenmod"
                },
                {
                    "name": "Supervillain Wanted",
                    "status": "Cập nhật",
                    "note": "One Hit Kill, Dumb Enemies, Speed",
                    "description": "Trở thành siêu phản diện bị truy nã gắt gao nhất.",
                    "link": "https://play.google.com/store/apps/details?id=io.supervlabs.catchandtame.gl",
                    "videoId": "NF6nNIqX2QU",
                    "discordLink": "https://discord.gg/edenmod"
                },
                {
                    "name": "Epic Shaman Battle: 4P Defense",
                    "status": "Cập nhật",
                    "note": "One Hit Kill, God Mode",
                    "description": "Trận chiến pháp sư sử thi với chế độ phòng thủ 4 người.",
                    "link": "https://play.google.com/store/apps/details?id=com.wemade.tales",
                    "videoId": "KpeaZL4GKaw",
                    "discordLink": "https://discord.gg/edenmod"
                },
                {
                    "name": "Raise Your Knightly Order:Idle",
                    "status": "Cập nhật",
                    "note": "Free Shop, Add Custom Resource, Speed",
                    "description": "Xây dựng đội quân hiệp sĩ của bạn.",
                    "link": "https://play.google.com/store/apps/details?id=com.superplanet.knight",
                    "videoId": "NF6nNIqX2QU",
                    "discordLink": "https://discord.gg/edenmod"
                },
                {
                    "name": "Tiny Reaper: Reborn",
                    "status": "Hoạt động",
                    "note": "Custom Shop Amount + Cost, No Skill CD + Max Attack Range + Attack All Targets, Dumb Enemies, Speed",
                    "description": "Thần chết tí hon tái sinh với sức mạnh tùy chỉnh.",
                    "link": "https://play.google.com/store/apps/details?id=com.xchange.blob",
                    "videoId": "_6lX-HS9owE",
                    "discordLink": "https://discord.gg/edenmod"
                },
                {
                    "name": "Chuyển Sinh Ta Là Vua Tam Quốc",
                    "status": "Hoạt động",
                    "note": "Damage Multiplier, Defense Multiplier, Speed",
                    "description": "Chuyển sinh và trở thành vua của thời Tam Quốc.",
                    "link": "https://play.google.com/store/apps/details?id=vn.funtap.chuyensinh",
                    "videoId": "ZNYsG_YjkUQ",
                    "discordLink": "https://discord.gg/edenmod"
                },
                {
                    "name": "Rush Knights : Idle RPG",
                    "status": "Hoạt động",
                    "note": "Free Shop, Speed",
                    "description": "Các hiệp sĩ xông lên trong một game RPG nhàn rỗi.",
                    "link": "https://play.google.com/store/apps/details?id=com.gaimstudio.knightage",
                    "videoId": "1aRMYlzk7Z0",
                    "discordLink": "https://discord.gg/edenmod"
                },
                {
                    "name": "Siêu Đậu Tiến Công",
                    "status": "Hoạt động",
                    "note": "Damage Multiplier, Defense Multiplier, Speed",
                    "description": "Siêu Đậu Tiến Công GAME Bạn đã sẵn sàng bước vào vườn rau chiến thuật, nơi những hạt đậu tí hon có thể trở thành chiến thần?",
                    "link": "https://play.google.com/store/apps/details?id=vn.funtap.gardenbattle",
                    "videoId": "NF6nNIqX2QU",
                    "discordLink": "https://discord.gg/edenmod"
                },
                {
                    "name": "Seraphim Saga: Idle RPG",
                    "status": "Hoạt động",
                    "note": "Gold/EXP Multiplier, Mail Reward Bug, Added Weak Enemy Speed",
                    "description": "SSR của game nhập vai nhàn rỗi!",
                    "link": "https://play.google.com/store/apps/details?id=com.EOAG.WingsIdle",
                    "videoId": "s3P0YUgSo90",
                    "discordLink": "https://discord.gg/edenmod"
                },
                {
                    "name": "Let Go Rain – Cute Idle RPG",
                    "status": "Hoạt động",
                    "note": "Rain's Journey – Game phiêu lưu RPG nhàn rỗi cực cuốn!",
                    "description": "SSR của game nhập vai nhàn rỗi!",
                    "link": "https://play.google.com/store/apps/details?id=com.rubycore.pp&hl=vi",
                    "videoId": "ui-Exg14Yww",
                    "discordLink": "https://discord.gg/edenmod"
                },
                {
                    "name": "Raising an Assassin: Idle RPG",
                    "status": "Hoạt động",
                    "note": "Free Shop, Guest Login. Speed",
                    "description": "Nuôi dưỡng một sát thủ: Mới mở!.Sự kết hợp hoàn hảo giữa hành động chấm và game nhập vai nhàn rỗi! Trở thành huyền thoại thông qua cuộc chiến bí mật, chết chóc.",
                    "link": "https://play.google.com/store/apps/details?id=highpixel.billion",
                    "videoId": "XDVHyje4Pao",
                    "discordLink": "https://discord.gg/edenmod"
                },
                {
                    "name": " XP Hero",
                    "status": "Hoạt động",
                    "note": "Resources Injection, Speed",
                    "description": "🔥 Bước vào thế giới nguy hiểm và bí ẩn cùng chiến binh huyền thoại! ⚔️",
                    "link": "https://play.google.com/store/apps/details?id=io.supercent.weaponrpg&hl=vi",
                    "videoId": "vl1upD-BEQg",
                    "discordLink": "https://discord.gg/edenmod"
                },
                {
                    "name": "Silver and Blood",
                    "status": "Hoạt động",
                    "note": "Damage Multiplier, Defense Multiplier, God Mode, Dump Enemy, Auto Kill, speed",
                    "description": "Máu là nguồn sống và là vật mang ký ức. Trong thế giới này, máu bạc là biểu tượng của sức mạnh và quyền lực. Hãy trở thành người sở hữu sức mạnh tối thượng với bản mod này.",
                    "link": "https://play.google.com/store/apps/details?id=com.moonton.silverblood.ap&hl=vi",
                    "videoId": "BVdUPgQZgcU",
                    "discordLink": "https://discord.gg/edenmod"
                }
            ];

            const featureIcons = {
                'damage': `<svg class="feature-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M14.5 4.5l7 7L8 25l-6-6 12.5-12.5z"></path><path d="M4.5 19.5L9 15"></path></svg>`,
                'defense': `<svg class="feature-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>`,
                'speed': `<svg class="feature-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg>`,
                'cooldown': `<svg class="feature-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M12 8v4l3 3"></path><path d="M21 12a9 9 0 1 1-9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path></svg>`,
                'win': `<svg class="feature-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M12 8V2l4 4-4 4"></path><path d="M20 12v-2a4 4 0 0 0-4-4H8"></path><path d="M4 12v2a4 4 0 0 0 4 4h8"></path><path d="M12 16v6l-4-4 4-4"></path></svg>`,
                'god': `<svg class="feature-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path></svg>`,
                'resource': `<svg class="feature-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line></svg>`,
                'unlock': `<svg class="feature-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 9.9-1"></path></svg>`,
                'kill': `<svg class="feature-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>`,
                'default': `<svg class="feature-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M12 20.94c-4.48-1.5-8-5.88-8-10.94V5l8-3 8 3v6"></path><path d="M18 15v6"></path><path d="M21 18h-6"></path></svg>`
            };

            const statusMap = {
                ok: { key: 'ok', color: 'var(--status-ok)', text: 'Hoạt động', icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"></path><path d="m9 12 2 2 4-4"></path></svg>` },
                updating: { key: 'updating', color: 'var(--status-updating)', text: 'Cập nhật', icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path><path d="M3 3v5h5"></path><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"></path><path d="M21 21v-5h-5"></path></svg>` },
                stopped: { key: 'stopped', color: 'var(--status-stopped)', text: 'Đã dừng', icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>` }
            };

            let currentStatusFilter = 'all';
            let searchTimeoutId = null;
            let lastProcessedValue = '';
            const renderGameListWithDelay = () => {
                const currentValue = searchInput.value.trim();

                // Nếu giá trị không thay đổi, không làm gì
                if (currentValue === lastProcessedValue) return;

                // Clear timeout cũ nếu có
                if (searchTimeoutId) {
                    clearTimeout(searchTimeoutId);
                }

                // Hiển thị loading spinner nếu có từ khóa
                if (currentValue && !gameListContainer.querySelector('.loading-spinner')) {
                    gameListContainer.innerHTML = '<div class="loading-spinner"><div class="spinner"></div><p>Đang tìm kiếm...</p></div>';
                }

                // Đặt độ trễ 300ms trước khi thực sự tìm kiếm
                searchTimeoutId = setTimeout(() => {
                    lastProcessedValue = currentValue;
                    const searchTerm = currentValue.toLowerCase();
                    let filteredGames = [...gameData];

                    if (currentStatusFilter !== 'all') {
                        filteredGames = filteredGames.filter(game =>
                            game.statusInfo.key === currentStatusFilter
                        );
                    }

                    if (searchTerm) {
                        filteredGames = filteredGames.filter(game =>
                            game.name.toLowerCase().includes(searchTerm)
                        );
                    }

                    displayGames(filteredGames);
                }, 300);
            };


            // --- Utility Functions ---
            const getIconForFeature = (featureText) => {
                const text = featureText.toLowerCase();
                if (text.includes('damage') || text.includes('attack') || text.includes('ohk')) return featureIcons.damage;
                if (text.includes('defense')) return featureIcons.defense;
                if (text.includes('speed')) return featureIcons.speed;
                if (text.includes('cooldown') || text.includes('cd')) return featureIcons.cooldown;
                if (text.includes('win')) return featureIcons.win;
                if (text.includes('god')) return featureIcons.god;
                if (text.includes('resource') || text.includes('gold') || text.includes('coin') || text.includes('diamond')) return featureIcons.resource;
                if (text.includes('unlock') || text.includes('free')) return featureIcons.unlock;
                if (text.includes('kill') || text.includes('enemies')) return featureIcons.kill;
                return featureIcons.default;
            };

            const processData = (rawData) => {
                return rawData.map(game => {
                    const features = (game.note || '').split(/,/).map(f => f.trim()).filter(f => f);
                    let statusInfo = statusMap.stopped;
                    const lowerCaseStatus = (game.status || "").toLowerCase();
                    if (lowerCaseStatus.includes('hoạt động')) statusInfo = statusMap.ok;
                    else if (lowerCaseStatus.includes('cập nhật')) statusInfo = statusMap.updating;
                    const id = game.name.toLowerCase().replace(/[^a-z0-9]+/g, '-');
                    return { ...game, id, statusInfo, features, devName: game.devName || "Vô danh" };
                });
            };

            const gameData = processData(rawGameData);

            // --- Rating Functions ---
            const renderStars = (rating) => {
                const fullStars = Math.round(rating); // Làm tròn để không có nửa sao
                let stars = '';

                for (let i = 1; i <= 5; i++) {
                    if (i <= fullStars) {
                        stars += '★';
                    } else {
                        stars += '☆';
                    }
                }

                return stars;
            };

            const updateStarDisplay = (rating) => {
                const stars = document.querySelectorAll('#ratingModal .star');
                stars.forEach((star, index) => {
                    if (index < rating) {
                        star.textContent = '★';
                        star.style.color = 'var(--star-color)';
                    } else {
                        star.textContent = '☆';
                        star.style.color = 'var(--star-empty)';
                    }
                });
            };

            // --- Main Functions ---
            let displayGamesTimeout;
            const displayGames = async (games) => {
                if (displayGamesTimeout) {
                    clearTimeout(displayGamesTimeout);
                }

                gameListContainer.innerHTML = '';
                gameCounter.textContent = `Tìm thấy ${games.length} tín hiệu trong vũ trụ.`;

                if (games.length === 0) {
                    gameListContainer.innerHTML = '<p class="no-results">Không có tín hiệu nào phù hợp...</p>';
                    return;
                }

                // Lấy dữ liệu rating từ Firebase
                const ratingsSnapshot = await database.ref('games').once('value');
                const allRatingsData = ratingsSnapshot.val() || {};

                // Tạo mảng game với thông tin rating để sắp xếp
                const gamesWithRatings = games.map(game => {
                    const gameRatings = allRatingsData[game.id] || {};
                    return {
                        ...game,
                        averageRating: parseFloat(gameRatings.averageRating) || 0,
                        totalRatings: gameRatings.totalRatings || 0,
                        userRating: currentUser ? (gameRatings.ratings ? gameRatings.ratings[currentUser.uid] : null) : null
                    };
                });

                // Sắp xếp game theo điểm đánh giá từ cao đến thấp
                gamesWithRatings.sort((a, b) => b.averageRating - a.averageRating);

                gamesWithRatings.forEach(game => {
                    const card = document.createElement('article');
                    card.className = 'game-card';
                    card.dataset.gameId = game.id;
                    card.style.setProperty('--status-color', game.statusInfo.color);

                    const featuresHTML = game.features.length > 0 ?
                        `<ul class="features-list">${game.features.map(f => `<li class="feature-tag">${getIconForFeature(f)}<span>${f}</span></li>`).join('')}</ul>` :
                        '<p>Không có dữ liệu chức năng.</p>';

                    // Tạo HTML cho rating info dựa trên trạng thái đăng nhập
                    let ratingHTML = '';
                    if (currentUser) {
                        if (game.userRating) {
                            ratingHTML = `
                    <div class="rating-info">
                        <div class="stars">${renderStars(game.averageRating)}</div>
                        <span class="rating-text">(${game.totalRatings} đánh giá)</span>
                        <span class="rating-text">Bạn đã đánh giá: ${game.userRating}★</span>
                    </div>`;
                        } else {
                            ratingHTML = `
                    <div class="rating-info">
                        <div class="stars">${renderStars(game.averageRating)}</div>
                        <span class="rating-text">(${game.totalRatings} đánh giá)</span>
                        <button class="rating-button" onclick="event.stopPropagation(); openRatingModal('${game.id}', '${game.name}')">Đánh giá</button>
                    </div>`;
                        }
                    } else {
                        ratingHTML = `
                <div class="rating-info">
                    <div class="stars">${renderStars(game.averageRating)}</div>
                    <span class="rating-text">(${game.totalRatings} đánh giá)</span>
                    <button class="rating-button" onclick="event.stopPropagation(); document.getElementById('discordLoginModal').style.display='block'; localStorage.setItem('currentGameToRate', '${game.id}'); document.getElementById('gameToRateName').textContent = '${game.name}'">Đăng nhập để đánh giá</button>
                </div>`;
                    }

                    card.innerHTML = `
            <h3>${game.name}</h3>
            <div class="info-item">
                <div class="icon-wrapper">${game.statusInfo.icon}</div>
                <span>Trạng thái: <strong class="status">${game.statusInfo.text}</strong></span>
            </div>
            <div class="info-item">
                <div class="icon-wrapper">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><circle cx="12" cy="8" r="1"/></svg>
                </div>
                <span>Dev: <strong>${game.devName || "Nobody"}</strong></span>
            </div>
            <div class="info-item">
                <div class="icon-wrapper">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
                </div>
                <span><b>Require:</b> No Root</span>
            </div>
            ${ratingHTML}
            <div class="features-wrapper"><strong>Tín hiệu Mod:</strong>${featuresHTML}</div>`;

                    card.addEventListener('click', () => showDetailView(game.id));
                    gameListContainer.appendChild(card);
                });
            };

            const showDetailView = async (gameId) => {
                const game = gameData.find(g => g.id === gameId);
                if (!game) return;

                // Lấy dữ liệu rating từ Firebase
                const ratingsSnapshot = await database.ref(`games/${game.id}`).once('value');
                const ratingsData = ratingsSnapshot.val() || {};
                const averageRating = parseFloat(ratingsData.averageRating) || 0;
                const totalRatings = ratingsData.totalRatings || 0;

                // Lấy dữ liệu comments từ Firebase
                const commentsSnapshot = await database.ref(`games/${game.id}/comments`).once('value');
                const commentsData = commentsSnapshot.val() || {};

                // Hiển thị thông tin cơ bản của game
                const detailTitleElement = document.getElementById('detail-title');
                detailTitleElement.innerHTML = '';
                const titleLink = document.createElement('a');
                titleLink.href = game.link || '#';
                titleLink.textContent = game.name;
                titleLink.target = '_blank';
                titleLink.rel = 'noopener noreferrer';
                detailTitleElement.appendChild(titleLink);

                document.querySelector('#detail-description p').textContent = game.description || "Chưa có mô tả chi tiết cho game này.";

                // Hiển thị video
                const videoContainer = document.getElementById('video-container');
                videoContainer.innerHTML = game.videoId ?
                    `<iframe src="https://www.youtube.com/embed/${game.videoId}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>` :
                    `<div style="display:grid; place-items:center; width:100%; height:100%; color:var(--text-secondary); text-align:center; padding: 2rem;">Không có video demo cho game này.</div>`;

                // Hiển thị features
                document.querySelector('#detail-features .features-list').innerHTML = game.features.map(f =>
                    `<li class="feature-tag">${getIconForFeature(f)}<span>${f}</span></li>`
                ).join('');

                // Cập nhật Discord link
                document.getElementById('detail-discord-link').href = game.discordLink || "https://discord.gg/edenmod";

                // Tạo phần rating và comment
                const detailContent = document.querySelector('.detail-content');

                // Xóa các phần cũ nếu có
                const oldRatingSection = detailContent.querySelector('.rating-section');
                if (oldRatingSection) detailContent.removeChild(oldRatingSection);

                const oldCommentsSection = detailContent.querySelector('.comments-section');
                if (oldCommentsSection) detailContent.removeChild(oldCommentsSection);

                // Thêm phần rating
                const ratingSection = document.createElement('div');
                ratingSection.className = 'rating-section';
                ratingSection.innerHTML = `
        <div style="margin: 2rem 0; padding: 1.5rem; background: var(--glass-bg); border-radius: 12px; border: 1px solid var(--border-color);">
            <h3>Đánh giá từ cộng đồng</h3>
            <div style="display: flex; align-items: center; gap: 1rem; margin: 1rem 0;">
                <div style="font-size: 2.5rem; font-weight: bold; color: var(--primary-accent);">
                    ${averageRating.toFixed(1)}
                </div>
                <div>
                    <div style="font-size: 1.5rem; color: var(--star-color);">
                        ${renderStars(averageRating)}
                    </div>
                    <div style="color: var(--text-secondary);">
                        Dựa trên ${totalRatings} đánh giá
                    </div>
                </div>
            </div>
            <button onclick="openRatingModal('${game.id}', '${game.name}')" 
                    style="background: var(--primary-accent); border: none; color: white; 
                           padding: 10px 20px; border-radius: 50px; margin-top: 0.5rem; 
                           cursor: pointer; transition: all 0.3s ease;">
                Đánh giá game này
            </button>
        </div>
    `;
                detailContent.insertBefore(ratingSection, detailContent.children[3]);

                // Thêm phần comments
                const commentsSection = document.createElement('div');
                commentsSection.className = 'comments-section';
                commentsSection.innerHTML = `
    <div style="margin: 2rem 0;">
        <h3>Nhận xét từ cộng đồng</h3>
        <div id="comments-list" style="margin-top: 1rem;">
            ${Object.keys(commentsData).length > 0
                        ? Object.entries(commentsData)
                            .sort((a, b) => b[1].timestamp - a[1].timestamp)
                            .map(([key, comment]) => {
                                const userRating = ratingsData.ratings ? ratingsData.ratings[key] : null;
                                return `
                        <div style="background: var(--glass-bg); padding: 1rem; border-radius: 8px; margin-bottom: 1rem; border: 1px solid var(--border-color);">
                            <div class="comment-header">
                                <div class="comment-user">
                                    <img src="${comment.authorPhoto || 'https://cdn.discordapp.com/embed/avatars/0.png'}" 
                                         width="30" height="30" style="border-radius: 50%;">
                                    <strong>${comment.author}</strong>
                                </div>
                                ${userRating ? `<span class="comment-rating">${'★'.repeat(userRating)}${'☆'.repeat(5 - userRating)}</span>` : ''}
                                <span class="comment-date">
                                    ${new Date(comment.timestamp).toLocaleDateString('vi-VN')}
                                </span>
                            </div>
                            <p style="margin: 0; line-height: 1.5;">${comment.text}</p>
                        </div>
                    `;
                            }).join('')
                        : '<p style="color: var(--text-secondary); text-align: center; padding: 1rem;">Chưa có nhận xét nào. Hãy là người đầu tiên đánh giá!</p>'}
        </div>
    </div>
`;
                detailContent.appendChild(commentsSection);

                // Hiển thị detail view
                document.getElementById('main-view').style.display = 'none';
                document.getElementById('detail-view').style.display = 'block';
                window.scrollTo(0, 0);
            };

            const renderGameList = () => {
                const searchTerm = searchInput.value.toLowerCase().trim();
                let filteredGames = gameData;
                if (currentStatusFilter !== 'all') {
                    filteredGames = filteredGames.filter(game => game.statusInfo.key === currentStatusFilter);
                }
                if (searchTerm) {
                    filteredGames = filteredGames.filter(game => game.name.toLowerCase().includes(searchTerm));
                }
                displayGames(filteredGames);
            };

            const filterByStatus = (event, statusKey) => {
                currentStatusFilter = statusKey;
                document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
                event.currentTarget.classList.add('active');
                renderGameList();
            };

            const copyDiscordLink = (button) => {
                const link = document.getElementById('detail-discord-link').href;
                navigator.clipboard.writeText(link).then(() => {
                    button.textContent = 'Đã sao chép!';
                    setTimeout(() => { button.textContent = 'Sao chép Link'; }, 2000);
                });
            };

            const showMainView = () => {
                detailView.style.display = 'none';
                mainView.style.display = 'block';
                window.scrollTo(0, 0);
            };

            // --- Rating Modal Functions ---
            const openRatingModal = (gameId, gameName) => {
                localStorage.setItem('currentGameToRate', gameId);
                currentGameToRate = gameId;
                currentRating = 0;

                if (!firebase.auth().currentUser) {
                    document.getElementById('ratingModal').style.display = 'none';
                    document.getElementById('gameToRateName').textContent = gameName;
                    document.getElementById('discordLoginModal').style.display = 'block';
                    return;
                }

                // Kiểm tra đăng nhập
                if (!currentUser) {
                    document.getElementById('ratingModal').style.display = 'none';
                    document.getElementById('discordLoginModal').style.display = 'block';
                    document.getElementById('gameToRateName').textContent = gameName;
                    currentGameToRate = gameId;
                    return;
                }

                // Kiểm tra xem người dùng đã đánh giá game này chưa
                database.ref(`games/${gameId}/ratings/${currentUser.uid}`).once('value').then(snapshot => {
                    if (snapshot.exists()) {
                        document.getElementById('ratingStatus').textContent = 'Bạn đã đánh giá game này trước đó.';
                        document.getElementById('ratingStatus').className = 'rating-status error';
                        setTimeout(closeRatingModal, 2000);
                        return;
                    }

                    currentGameToRate = gameId;
                    document.getElementById('ratingGameTitle').textContent = `Đánh giá: ${gameName}`;
                    document.getElementById('ratingStatus').textContent = '';
                    document.getElementById('ratingStatus').className = 'rating-status';
                    document.getElementById('ratingComment').value = '';
                    document.getElementById('ratingError').style.display = 'none';
                    document.getElementById('ratingModal').style.display = 'block';
                    currentRating = 0;
                    updateStarDisplay(0);
                }).catch(error => {
                    console.error('Error checking rating:', error);
                });
            };

            const closeRatingModal = () => {
                document.getElementById('ratingModal').style.display = 'none';
                document.getElementById('discordLoginModal').style.display = 'none';
            };

            let currentRating = 0;

            // Hàm cập nhật số sao đã chọn
            const updateRating = (rating) => {
                currentRating = rating;
                updateStarDisplay(rating);
                document.getElementById('ratingError').style.display = 'none';
            };

            // Hàm kiểm tra và gửi đánh giá
            const submitRating = () => {
                const comment = document.getElementById('ratingComment').value.trim();

                if (currentRating === 0 || comment === '') {
                    document.getElementById('ratingError').style.display = 'block';
                    return;
                }

                rateGame(currentRating);
            };

            const rateGame = async (rating) => {
                if (!currentUser || !currentGameToRate) return;

                const comment = document.getElementById('ratingComment').value.trim();

                try {
                    const userId = currentUser.uid;
                    const gameRef = database.ref(`games/${currentGameToRate}/ratings/${userId}`);
                    const commentsRef = database.ref(`games/${currentGameToRate}/comments/${userId}`);

                    // Lưu đánh giá
                    await gameRef.set(rating);
                    await commentsRef.set({
                        text: comment,
                        author: currentUser.displayName || "Ẩn danh",
                        authorPhoto: currentUser.photoURL || null,
                        timestamp: firebase.database.ServerValue.TIMESTAMP
                    });

                    // Tính toán lại điểm trung bình
                    const ratingsRef = database.ref(`games/${currentGameToRate}/ratings`);
                    const snapshot = await ratingsRef.once('value');
                    const ratings = snapshot.val() || {};

                    let total = 0;
                    let count = 0;

                    for (const userId in ratings) {
                        total += ratings[userId];
                        count++;
                    }

                    const average = total / count;

                    // Cập nhật điểm trung bình và tổng số đánh giá
                    await database.ref(`games/${currentGameToRate}`).update({
                        averageRating: average.toFixed(1),
                        totalRatings: count
                    });

                    document.getElementById('ratingStatus').textContent = 'Cảm ơn đánh giá và nhận xét!';
                    document.getElementById('ratingStatus').className = 'rating-status success';

                    setTimeout(() => {
                        closeRatingModal();
                        renderGameList();
                        if (document.getElementById('detail-view').style.display === 'block') {
                            showDetailView(currentGameToRate);
                        }
                    }, 1000);
                } catch (error) {
                    console.error('Lỗi khi lưu đánh giá:', error);
                    document.getElementById('ratingStatus').textContent = 'Có lỗi xảy ra, vui lòng thử lại!';
                    document.getElementById('ratingStatus').className = 'rating-status error';
                }
            };

            // --- Discord Authentication Functions ---
            const loginWithDiscord = () => {
                const provider = new firebase.auth.OAuthProvider('oidc.discord');

                // Thêm các scope cần thiết
                provider.addScope('identify');
                provider.addScope('email');

                // Đặt custom parameters nếu cần
                provider.setCustomParameters({
                    prompt: 'consent'
                });

                firebase.auth().signInWithPopup(provider)
                    .then((result) => {
                        console.log('Đăng nhập thành công:', result.user);
                    })
                    .catch((error) => {
                        console.error('Lỗi đăng nhập:', error);
                        alert('Đăng nhập thất bại: ' + error.message);
                    });
            };

            // Thêm hàm xử lý sau khi redirect trở về
            firebase.auth().getRedirectResult()
                .then((result) => {
                    if (result.user) {
                        currentUser = result.user;
                        updateUserUI(result.user);

                        const gameToRate = localStorage.getItem('currentGameToRate');
                        if (gameToRate) {
                            const game = gameData.find(g => g.id === gameToRate);
                            if (game) {
                                openRatingModal(gameToRate, game.name);
                            }
                        }
                    }
                })
                .catch((error) => {
                    console.error('Lỗi xử lý redirect:', error);
                });

            const logout = async () => {
                try {
                    await firebase.auth().signOut();
                    currentUser = null;
                    document.getElementById('user-info').style.display = 'none';
                    document.getElementById('discordLoginModal').style.display = 'none';
                } catch (error) {
                    console.error('Logout error:', error);
                }
            };
            window.logout = logout; // Thêm dòng này để hàm có thể gọi từ HTML


            const checkAuthState = () => {
                firebase.auth().onAuthStateChanged(async (user) => {
                    console.log('Auth state changed - Current user:', user ? user.uid : 'None');

                    if (user) {
                        currentUser = user;
                        document.getElementById('discordLoginModal').style.display = 'none';
                        updateUserUI(user);
                        renderGameList();

                        // Chỉ kiểm tra game đang chờ đánh giá nếu có trong URL params
                        const urlParams = new URLSearchParams(window.location.search);
                        const ratingRequested = urlParams.get('rating');

                        if (ratingRequested) {
                            const gameToRate = localStorage.getItem('currentGameToRate');
                            if (gameToRate) {
                                const game = gameData.find(g => g.id === gameToRate);
                                if (game) {
                                    console.log('Opening rating modal for saved game:', game.name);
                                    // Kiểm tra lại trước khi mở modal
                                    const snapshot = await database.ref(`games/${gameToRate}/ratings/${user.uid}`).once('value');
                                    if (!snapshot.exists()) {
                                        setTimeout(() => {
                                            openRatingModal(gameToRate, game.name);
                                        }, 500);
                                    } else {
                                        localStorage.removeItem('currentGameToRate');
                                    }
                                }
                            }
                        }
                    } else {
                        currentUser = null;
                        document.getElementById('user-info').style.display = 'none';
                        console.log('User logged out');
                    }
                });
            };

            const handleOAuthCallback = async () => {
                const urlParams = new URLSearchParams(window.location.search);
                const code = urlParams.get('code');
                const error = urlParams.get('error');

                if (error) {
                    console.error('Discord login error:', error);
                    window.history.replaceState({}, document.title, window.location.pathname);
                    return;
                }

                if (code) {
                    try {
                        document.getElementById('preloader').classList.remove('loaded');

                        // Gửi code đến backend của bạn hoặc xử lý trực tiếp
                        const response = await fetch('https://your-backend-endpoint.com/auth/discord', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({ code, redirectUri: DISCORD_REDIRECT_URI })
                        });

                        const data = await response.json();

                        if (data.token) {
                            // Đăng nhập bằng custom token
                            const credential = await firebase.auth().signInWithCustomToken(data.token);
                            currentUser = credential.user;
                            updateUserUI(credential.user);
                            renderGameList();

                            // Kiểm tra game đang chờ đánh giá
                            const gameToRate = localStorage.getItem('currentGameToRate');
                            if (gameToRate) {
                                const game = gameData.find(g => g.id === gameToRate);
                                if (game) {
                                    openRatingModal(gameToRate, game.name);
                                }
                            }
                        }

                        window.history.replaceState({}, document.title, window.location.pathname);
                    } catch (error) {
                        console.error('Authentication failed:', error);
                    } finally {
                        document.getElementById('preloader').classList.add('loaded');
                    }
                }
            };

            const updateUserUI = (user) => {
                console.log('Updating UI for user:', user.uid, user.displayName);

                const userInfo = document.getElementById('user-info');
                const username = document.getElementById('username');
                const userAvatar = document.getElementById('user-avatar');

                userInfo.style.display = 'block';
                username.textContent = user.displayName || 'Người dùng Discord';
                userAvatar.src = user.photoURL || 'https://cdn.discordapp.com/embed/avatars/0.png';

                console.log('UI updated for user:', user.uid); // Thêm dòng này
            };

            // --- Initialize App ---
            const initApp = async () => {
                // Kiểm tra OAuth callback
                await handleOAuthCallback();

                // Kiểm tra trạng thái đăng nhập
                checkAuthState();

                // Thêm sự kiện đóng modal khi click bên ngoài
                window.addEventListener('click', (event) => {
                    if (event.target === document.getElementById('ratingModal')) {
                        closeRatingModal();
                    }
                    if (event.target === document.getElementById('discordLoginModal')) {
                        document.getElementById('discordLoginModal').style.display = 'none';
                    }
                });

                searchInput.addEventListener('input', () => {
                    renderGameListWithDelay();
                });

                // Render game list ban đầu
                renderGameList();
            };

            // --- Make functions globally accessible for HTML onclick ---
            window.showMainView = showMainView;
            window.renderGameList = renderGameList;
            window.filterByStatus = filterByStatus;
            window.copyDiscordLink = copyDiscordLink;
            window.openRatingModal = openRatingModal;
            window.closeRatingModal = closeRatingModal;
            window.rateGame = rateGame;
            window.loginWithDiscord = loginWithDiscord;
            window.updateRating = updateRating;
            window.submitRating = submitRating;
            // Khởi tạo ứng dụng
            initApp();

            // Three.js background setup
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('galaxy-bg'), alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);

            const starGeo = new THREE.BufferGeometry();
            const starCount = 6000;
            const posArray = new Float32Array(starCount * 3);
            for (let i = 0; i < starCount * 3; i++) {
                posArray[i] = (Math.random() - 0.5) * 1000;
            }
            starGeo.setAttribute('position', new THREE.BufferAttribute(posArray, 3));

            const starMaterial = new THREE.PointsMaterial({ size: 0.7, color: 0xffffff, transparent: true });
            const stars = new THREE.Points(starGeo, starMaterial);
            scene.add(stars);
            camera.position.z = 5;

            let mouseX = 0;
            let mouseY = 0;
            document.addEventListener('mousemove', (e) => {
                mouseX = e.clientX;
                mouseY = e.clientY;
            });

            function animate() {
                requestAnimationFrame(animate);
                stars.rotation.x += 0.0001;
                stars.rotation.y += 0.0002;
                if (mouseX > 0) {
                    camera.position.x += (mouseX - window.innerWidth / 2 - camera.position.x) * 0.00005;
                    camera.position.y += (-(mouseY - window.innerHeight / 2) - camera.position.y) * 0.00005;
                    camera.lookAt(scene.position);
                }
                renderer.render(scene, camera);
            }
            animate();

            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });
        });
    </script>
</body>

</html>
